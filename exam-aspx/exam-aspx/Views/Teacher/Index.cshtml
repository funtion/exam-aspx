@{
    Layout = "~/Views/Shared/_TeacherLayout.cshtml";
    ViewBag.Title = "Teacher";
}

<nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid">

        <div class="navbar-header">
            <a class="navbar-brand" href="#">教师中心</a>
        </div>


        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                <li class="active"><a href="/Teacher/Index">考试管理</a></li>
                <li><a href="/Teacher/Announcement">公告管理</a></li>
                <li><a href="/Teacher/Student">学生管理</a></li>
                <li><a href="/Teacher/File">文件管理</a></li>

            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="/Teacher/Logout">退出登录</a></li>
            </ul>
        </div>
    </div>
</nav>


<div class="container">

    <div class="row">
        <div class="col-md-12">
            <div class="Product">
                <table id="product_info">
                    <thead>
                        <tr>
                            <th>名称</th>
                            <th>单选数量</th>
                            <th>多选数量</th>
                            <th>判断数量</th>
                            <th>单选分数</th>
                            <th>多选分数</th>                      
                            <th>判断分数</th>
                            <th>考试时间</th>
                            <th>状态</th>
                            <th>操作
                                <a class="btn btn-info" data-toggle="modal"
                                   data-target="#myModal">
                                    添加考试
                                    <i class="halflings-icon white edit"></i>
                                </a>
                                
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                 @foreach(var exam in ViewBag.examList){
                        <tr>
                            <td class="center">@exam.name</td>
                            <td class="center">@exam.sNumber</td>
                            <td class="center">@exam.mNumber</td>
                            <td class="center">@exam.tNumber</td>
                            <td class="center">@exam.sScore</td>
                            <td class="center">@exam.mScore</td>
                            <td class="center">@exam.tScore</td>
                            <td class="center">@exam.time</td>
                            @if(exam.ready==0){
                                <td class="center">不可见</td>}
                             else
                                {<td class="center">可见</td>}
                            <td>

                                <a class="btn btn-info" onclick="setExamName(@exam.id,'@HttpUtility.UrlEncode(exam.name)')">
                                    修改名称
                                    <i class=" halflings-icon white edit">
                                    </i>
                                </a>
                                <a class="btn btn-info" onclick="modifyStatus(@exam.id,@exam.ready)">
                                    更改状态
                                    <i class="halflings-icon white edit"></i>
                                </a>
                                <a class="btn btn-info" href="Result?exam=@exam.id">
                                    成绩
                                    <i class="halflings-icon white edit"></i>
                                </a>
                                <a class="btn btn-danger" onclick="deleteExam(@exam.id)">
                                    删除
                                    <i class="halflings-icon white trash"></i>
                                </a>
                                
                            </td>
                        </tr>
                 }




                    </tbody>
                </table>
            </div>
        </div>
    </div>

</div>
<!-- 模态框（Modal） -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog"
     aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close"
                        data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title" id="myModalLabel">
                    添加考试
                </h4>
            </div>
            <div class="modal-body">
                <form class="upload-form" method="post" action="AddExam">
                    <label>选择一个docx文件</label><input type="file" name="doc">
                </form>
                <div class="progress">
                    <div class="progress-bar" role="progressbar" aria-valuenow="40"
                         aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default"
                        data-dismiss="modal">
                    关闭
                </button>
                <button type="button" class="btn btn-primary" onclick="UploadFile()">
                    提交
                </button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>


<div class="modal fade" id="ExamName" tabindex="-1" role="dialog"
     aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close"
                        data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title" id="myModalLabel">
                    更改考试名称
                </h4>
            </div>
            <div class="modal-body">
                <div>
                    <span>名称：</span><textarea id="ExamName" style="width:100%">
                       
                    </textarea>

                </div>
            </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default"
                            data-dismiss="modal">
                        关闭
                    </button>
                    <button id="exam_submit" type="button" class="btn btn-primary">
                        提交
                    </button>
                </div>
            </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>
<!-- script for datatable -->
<script type="text/javascript">

	$(function(){
		var oTable = $("#product_info").dataTable(
		{
"bProcessing" : true,//加载数据时候是否显示进度条

"sPaginationType" : "full_numbers",
"oLanguage" : { //主要用于设置各种提示文本
"sProcessing" : "正在处理...", //设置进度条显示文本
"sLengthMenu" : "每页_MENU_行",//显示每页多少条记录
"sEmptyTable" : "没有找到记录",//没有记录时显示的文本
"sZeroRecords" : "没有找到记录",//没有记录时显示的文本
"sInfo" : "总数:_TOTAL_  当前:_START_至_END_",
/* "sInfo" : "当前页  _START_/_END_" , */
"sInfoEmpty" : "",//没记录时,关于记录数的显示文本
"sSearch" : "search:",//搜索框前的文本设置
"oPaginate" : {
	"sFirst" : "First",
	"sLast" : "Last",
	"sNext" : "Next",
	"sPrevious" : "Pre "
}
}//用于设置提示文本

});
oTable.css("font-size","12px");//设置文本的样式；
})
</script>

<script>
        function setExamName(id,name){
            $("#ExamName").modal();
            $("textarea#ExamName").html(decodeURI(name));
                   
            $("button#exam_submit").click(function () {
                var exam_name = $("textarea#ExamName").val();
                
                $.post(
                    "setExamName",
                    "id="+id+"&name="+exam_name,
                    success=function(data){
                        if(data.status=="success"){
                            alert("success!");
                            location.reload();
                        }
                        else{
                            alert("failed!"+data.error);
                            location.reload();

                        }
                    })    
            });
         }


       function UploadFile() {

           $(".upload-form").ajaxSubmit({
               url:"AddExam",
               type:"post",
               dataType:"json",
               beforeSend:function(){
                   
               },
               uploadProgress:function(event,position,total,percent){                         
                   console.log(percent);
                   $("div.progress-bar").css("width", percent + "%");
               },
               success:function(data){
                   console.log(data);
                   if(data.status!="success"){
                       $("div.progress-bar").css("width",   "0%");;
                       alert("upload failed."+data.error);
                       location.reload();
                   }
                   else{
                       
                       alert("upload success.");                    
                       location.reload();
                   }

               },
               error:function(){
                   
                   alert("network error.");
                   location.reload();
               }
           });
          
       }
	
       


         
       function modifyStatus(id,status){
               var targetStatus = (status + 1) % 2;
               $.post("ModifyExamStatus",
                       "id=" + id+"&status="+targetStatus,
                       success=function(data,textStatus,xhr){
                               alert(data['status']);
                                location.reload();
                            }
                          );
           }
        function deleteExam(id)
           {
                var b = confirm("This action will delete the record! Continue?");
                if(b==true){
                       $.post("DeleteExam",
                               "id="+id,
                               success=function(data){
                
                                        if(data['status']=="success"){
                                                alert("You have delete the record!");
                                               location.reload();
                                            }
                                        else{
                                            alert("delete failed!"+data.error);
                                            location.reload();
                                        }
                                });
                }
        }
</script>


